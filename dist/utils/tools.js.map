{"version":3,"file":"tools.js","sources":["../../src/utils/tools.ts"],"sourcesContent":["import * as tc from '@actions/tool-cache'\nimport * as core from '@actions/core'\nimport * as path from 'path'\n\ntype SupportedTool = 'helm'\ntype PlatformSubset = Extract<NodeJS.Platform, 'linux' | 'darwin' | 'win32'>\n\nconst toolDownloadUrl: Record<\n  SupportedTool,\n  Record<string, Record<PlatformSubset, string>>\n> = {\n  helm: {\n    latest: {\n      linux: 'https://get.helm.sh/helm-v3.14.4-linux-amd64.tar.gz',\n      darwin: 'https://get.helm.sh/helm-v3.14.4-darwin-amd64.tar.gz',\n      win32: 'https://get.helm.sh/helm-v3.14.4-windows-amd64.zip'\n    }\n  }\n}\n\nexport async function fetchTcTool(\n  tool: SupportedTool,\n  version: string = 'latest'\n): Promise<boolean> {\n  // Ensure runner envs exist for tool-cache when running outside GitHub Actions\n  if (!process.env.RUNNER_TOOL_CACHE) {\n    process.env.RUNNER_TOOL_CACHE = `${process.cwd()}/.runner_tool_cache`\n  }\n  if (!process.env.RUNNER_TEMP) {\n    process.env.RUNNER_TEMP = `${process.cwd()}/.runner_temp`\n  }\n  const platform = process.platform as PlatformSubset\n  const toolDirectory = tc.find(tool, version, platform)\n  if (toolDirectory) {\n    core.info(\n      `Tool ${tool} version ${version} is already cached in ${toolDirectory}`\n    )\n    core.addPath(toolDirectory)\n    return true\n  } else {\n    core.info(`Tool ${tool} version ${version} is not cached, downloading...`)\n  }\n\n  // check if we have a download url for the tool\n  if (!toolDownloadUrl[tool]) {\n    throw new Error(`No download url found for tool: ${tool}`)\n  }\n\n  // check if we have a download url for the current version\n  if (!toolDownloadUrl[tool][version]) {\n    throw new Error(\n      `No download url found for tool: ${tool} version: ${version}`\n    )\n  }\n\n  // check if we have a download url for the current platform\n  if (!toolDownloadUrl[tool][version][platform]) {\n    throw new Error(\n      `No download url found for tool: ${tool} version: ${version} on platform: ${platform}`\n    )\n  }\n\n  // download the tool using tc cache\n  let downloadUrl = toolDownloadUrl[tool][version][platform]\n  const arch = process.arch\n  const archLabel = arch === 'x64' ? 'amd64' : arch === 'arm64' ? 'arm64' : arch\n  // Replace architecture segment in URL if needed\n  downloadUrl = downloadUrl.replace('amd64', archLabel)\n\n  const downloadPath = await tc.downloadTool(downloadUrl)\n  const isZip = downloadUrl.endsWith('.zip')\n  const extractedPath = isZip\n    ? await tc.extractZip(downloadPath)\n    : await tc.extractTar(downloadPath)\n\n  const platformName = platform === 'win32' ? 'windows' : platform\n  const binaryDir = path.join(extractedPath, `${platformName}-${archLabel}`)\n  const cachedPath = await tc.cacheDir(binaryDir, tool, version)\n  core.addPath(cachedPath)\n  core.info(`Tool ${tool} version ${version} has been cached in ${cachedPath}`)\n  return true\n}\n"],"names":[],"mappings":"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"}